#  AWS EC2 인스턴스 생성

서버를 띄우기 위한 기본 세팅이 끝나서 서버 구축을 해보겠습니다.

서버는 AWS EC2(AWS Compute Cloud)를 통해 구축할 수 있습니다. 

[AWS EC2 공식문서](https://docs.aws.amazon.com/ko_kr/ec2/index.html)를 보며 직접 구축해보겠습니다.

[티스토리 블로그 바로가기](https://kyleeee.tistory.com/entry/TIL33-AWS-EC2-인스턴스-생성)

<br>

## AWS Key Pair

우선, 서버 구축전에 키 페어 먼저 생성이 되어있어야 합니다.

퍼블릭 키 암호화를 통해 인스턴스에 대한 로그인 정보를 보호하기 때문인데, Linux 인스턴스에는 암호가 없으므로 인스턴스에 안전하게 로그인 하기 위해 키페어를 사용한다고 합니다.

EC2 메뉴로 이동하면, 리소스 항목 -> 키 페어를 클릭합니다.

![image](https://user-images.githubusercontent.com/88086271/189516013-f2aff060-2043-4412-a784-1ac08334b6f6.png)

<br>

키 페어 생성을 클릭한뒤, 각 항목들을 입력합니다.

![image](https://user-images.githubusercontent.com/88086271/189516064-f942e83f-0449-49fe-b256-6b831894ade2.png)

<br>

키 페어 유형에서 ED25519는 윈도우 인스턴스에서는 지원되지 않는다고 합니다.

프라이빗 키 형식의 경우, OpenSSH에서 사용할 수 있게 하려면 pem을 선택해야 합니다.

생성하게 되면 키 페어가 다운로드 되는데, 이 때가 다운받을 수 있는 마지막 기회이니 잘 보관해야 합니다.

<br>

macOS 또는 Linux 컴퓨터에서 SSH 클라이언트를 사용하여 Linux 인스턴스에 연결하려면 아래와 같은 명령어를 입력하여 해당 파일의 권한을 설정합니다. 이러한 권한을 설정하지 않으면 키 페어를 통해 인스턴스에 접근할 수 없다고 합니다.

```shell
chmod 400 키페어이름.pem
```

chmod 400 이란, [chmodcommand 공식문서](https://chmodcommand.com/chmod-400/)에 의하면 소유자가 읽을 수 있도록 해주는 명령어로 아래 이미지에 각 역할이 정리된 걸 확인할 수 있습니다.

![image](https://user-images.githubusercontent.com/88086271/189516325-18f0af71-2310-4f3f-81bf-e7d77094b818.png)

<br>

## 보안그룹생성

보안 그룹은 인스턴스에 대한 방화벽 역할을 하며 인스턴스 수준에서 인바운드 트래픽과 아웃바운드 트래픽을 모두 제어합니다. SSH를 사용하여 IP주소에서 인스턴스에 연결할 수 있게 하는 규칙을 보안 그룹에 추가해야합니다. 

EC2 메뉴 접속 후 네트워크 및 보안 -> 보안그룹으로 이동한 뒤, 보안 그룹 생성 버튼을 클릭합니다.

![image](https://user-images.githubusercontent.com/88086271/189516783-9e2eb8ee-0882-4d5a-83af-68663644cf2f.png)

<br>

기본 세부 정보, 인바운드 규칙, 아웃바운드 규칙 3가지로 나뉘어져 있으며 기본 세부 정보에선 보안 그룹의 이름과 설명을 입력합니다.

저는 제가 적용할 Repository의 이름이 dockers라서 dockers로 이름을 설정했습니다.

인바운드 규칙은 인스턴스에 특정 트래픽들이 도달할 수 있도록 허용하는 규칙을 의미합니다. 

보안 규칙의 유형등에 대해 설정을 하는데, 소스의 경우 Anywhere(위치 무관)을 선택하면 절대 안됩니다.

이렇게 되면 모든 인터넷의 IP주소에서 인스턴스에 엑세스 할 수 있기 때문입니다. 지금과 같은 테스트 환경에서야 잠시 하는 건 괜찮지만 프로덕션에선 절대 설정해선 안됩니다.

접근IP에 대해 추가로 설명을 하면, 

<br>

1. IP주소는 0.0.0.0 ~ 255.255.255.255까지 있고 이진수로 표현하면 11111111.11111111.11111111.11111111 이렇게 되어 있어서 32비트로 불립니다.
2. 0.0.0.0/0 은 모든 IPv4 주소를 의미합니다.
3. 0.0.0.0/n 은 이진수로 풀었을 때 n번째 자리까지 고정하겠다는 의미입니다. 0.0.0.0/16 이렇게 된다면 11111111.11111111.??? 이런식으로 쓰이게 됩니다.
4. ::/0 은 모든 IPv6 주소를 의미합니다. 뒤에 /가 붙었다면 IPv4와 같이 어디까지 고정하겠다라고 할 수 있습니다.

<br>

아웃바운드 규칙은 모든 아웃바운드 트래픽을 허용하는 기본 규칙을 유지합니다.

상황에 따라 허용할 프로토콜, 포트 범위 등을 설정할 수 있습니다.

태그의 경우, 선택사항이라 지금은 설정하지 않겠습니다.

이제 보안그룹 생성까지 마무리 되었으니, EC2 인스턴스를 만들어보겠습니다.

<br>

## EC2 Instance 생성

EC2 메뉴에서 인스턴스 시작을 누르면 이름, AMI 설정 등 다양한 항목들이 나옵니다.

이름은 각자 원하는 명으로 입력하시면 되고, AMI의 경우 프리티어 사용가능한 Amazon Linux를 선택하겠습니다.

다만, 커널이 5.10과 4.14버전 두 개를 선택할 수 있는데 2023년 6월 이후로 4.14버전 지원이 종료되어 5.10으로 선택했습니다.

[해당 문서 바로가기](https://aws.amazon.com/ko/about-aws/whats-new/2021/11/amazon-linux-2-ami-kernel-5-10/)

![image](https://user-images.githubusercontent.com/88086271/189517437-182c4bf7-6f49-4560-8b3d-8347a638686d.png)

<br>

인스턴스 유형은 t2.micro를 설정했고, 키 페어의 경우 위에서 생성한 걸 적용했습니다.

키 페어 없이 진행은 할 수는 있는데, 키 페어없이 인스턴스 시작 시 인스턴스에 연결할 수 없어 권장하지 않는다고 합니다.

![image](https://user-images.githubusercontent.com/88086271/189517467-02a61876-2135-4e5a-93e7-fd9676adad1e.png)

<br>

네트워크 설정의 경우, 보안그룹은 위에서 만든 보안그룹으로 변경했고 VPC/서브넷은 아직 공부가 필요하여 기본으로 설정한 후 인스턴스를 시작했습니다.

인스턴스가 연결되기까지 시간이 꽤 걸리며 연결되었다면 아래와 같이 나타나는 걸 볼 수 있습니다.

![image](https://user-images.githubusercontent.com/88086271/189517745-fbaad7e8-0a5c-4bed-a34e-461958a24594.png)
